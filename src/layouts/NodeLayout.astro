---
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Search from '../components/Search.astro';

type Props = CollectionEntry<'content'>['data'] & {
	children?: any;
};

const { title = 'Untitled' } = Astro.props;
---

<html lang="en">
	<head>
		<BaseHead title={title} description="mayphus tang's digital workshop" />
	</head>

        <body>
                <a href="#main" class="skip-link">Skip to main content</a>
                <nav id="toc" class="toc"></nav>
                <main id="main">
                        <article>
                                <h1><a href="/">{title}</a></h1>
                                <slot />
                        </article>
                        <Footer />
                </main>
                <Search />
                <script is:inline>
                        (() => {
                                const headings = Array.from(
                                        document.querySelectorAll('article h2, article h3')
                                );
                                if (
                                        headings.length >= 4 &&
                                        window.matchMedia('(min-width: 1024px)').matches
                                ) {
                                        const toc = document.getElementById('toc');
                                        if (!toc) return;
                                        const list = document.createElement('ul');
                                        headings.forEach(h => {
                                                const text = h.textContent ?? '';
                                                if (!h.id) {
                                                        h.id = text
                                                                .toLowerCase()
                                                                .replace(/\s+/g, '-');
                                                }
                                                const li = document.createElement('li');
                                                const a = document.createElement('a');
                                                a.textContent = text;
                                                a.href = '#' + h.id;
                                                li.appendChild(a);
                                                list.appendChild(li);
                                        });
                                        toc.appendChild(list);
                                        document.body.classList.add('with-toc');
                                }
                        })();
                </script>
        </body>
</html>

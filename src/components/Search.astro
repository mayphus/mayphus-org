---
---

<div id="search-overlay" class="search-overlay hidden">
	<div class="search-container">
		<div class="search-prompt">:</div>
		<div id="search" class="search-input-container"></div>
	</div>
</div>

<style>
	.search-overlay {
		position: fixed;
		top: 0;
		left: 0;
		width: 100vw;
		height: 100vh;
		background: rgba(0, 0, 0, 0.8);
		z-index: 1000;
		display: flex;
		align-items: flex-start;
		justify-content: center;
		padding-top: 20vh;
	}

	.search-overlay.hidden {
		display: none;
	}

	.search-container {
		background: #fafafa;
		border: 1px solid #ddd;
		border-radius: 12px;
		width: 90%;
		max-width: 500px;
		font-family: inherit;
		font-size: 14px;
		box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
		overflow: hidden;
	}

	.search-prompt {
		display: none;
	}

	.search-input-container {
		border-bottom: 1px solid #eee;
	}

	.search-help {
		padding: 6px 12px;
		font-size: 11px;
		color: #999;
		background: #f8f8f8;
		text-align: center;
	}

	:global(.pagefind-ui) {
		font-family: inherit;
		text-align: left;
	}

	:global(.pagefind-ui__search-clear) {
		display: none !important;
	}

	:global(.pagefind-ui__search-input) {
		width: 100%;
		padding: 12px 16px;
		border: none;
		border-radius: 0;
		font-size: 14px;
		font-family: inherit;
		background: #fafafa;
		outline: none;
	}

	:global(.pagefind-ui__results) {
		max-height: 400px;
		overflow-y: auto;
		border-top: 1px solid #eee;
		scrollbar-width: none; /* Firefox */
		-ms-overflow-style: none; /* IE and Edge */
	}

	:global(.pagefind-ui__results::-webkit-scrollbar) {
		display: none; /* Chrome, Safari, Opera */
	}

	:global(.pagefind-ui__result) {
		margin: 0;
		padding: 10px 16px;
		border-bottom: 1px solid #f0f0f0;
		font-size: 13px;
		cursor: pointer;
		transition: background-color 0.1s ease;
	}

	:global(.pagefind-ui__result:hover) {
		background: #f5f5f5;
	}

	:global(.pagefind-ui__result:last-child) {
		border-bottom: none;
	}

	:global(.pagefind-ui__result-title) {
		font-size: 13px;
		margin-bottom: 2px;
		line-height: 1.2;
		font-weight: bold;
	}

	:global(.pagefind-ui__result-excerpt) {
		font-size: 12px;
		color: #666;
		line-height: 1.2;
		margin: 0;
	}

	@media (prefers-color-scheme: dark) {
		.search-container {
			background: #1a1a1a;
			border-color: #333;
		}

		.search-help {
			background: #222;
			color: #888;
		}

		.search-input-container {
			border-bottom-color: #333;
		}

		:global(.pagefind-ui__search-input) {
			background: #1a1a1a;
			color: #ccc;
		}

		:global(.pagefind-ui__results) {
			border-top-color: #333;
		}

		:global(.pagefind-ui__result) {
			border-bottom-color: #2a2a2a;
		}

		:global(.pagefind-ui__result:hover) {
			background: #252525;
		}

		:global(.pagefind-ui__result-excerpt) {
			color: #999;
		}
	}
</style>

<script>
	import { PagefindUI } from "@pagefind/default-ui";

	let overlay: HTMLElement | null = null;

	// Initialize Pagefind after the page loads
	window.addEventListener('DOMContentLoaded', () => {
		overlay = document.getElementById('search-overlay');
		const searchElement = document.getElementById('search');
		
		if (searchElement) {
			new PagefindUI({ 
				element: searchElement,
				showSubResults: true,
				showImages: false,
				excerptLength: 30
			});
		}

		// Keyboard shortcuts
		document.addEventListener('keydown', (e) => {
			// Open search with / or Ctrl+S
			if ((e.key === '/' && !e.ctrlKey && !e.metaKey) || 
				(e.key === 's' && (e.ctrlKey || e.metaKey))) {
				
				// Don't trigger if user is typing in an input/textarea
				if (e.target && 
					((e.target as HTMLElement).tagName === 'INPUT' || 
					 (e.target as HTMLElement).tagName === 'TEXTAREA')) {
					return;
				}
				
				e.preventDefault();
				openSearch();
			}
			
			// Close search with Escape
			if (e.key === 'Escape' && overlay && !overlay.classList.contains('hidden')) {
				e.preventDefault();
				closeSearch();
			}
		});

		// Close search when clicking outside
		overlay?.addEventListener('click', (e) => {
			if (e.target === overlay) {
				closeSearch();
			}
		});
	});

	function openSearch() {
		if (overlay) {
			overlay.classList.remove('hidden');
			// Focus the search input
			setTimeout(() => {
				const input = overlay?.querySelector('.pagefind-ui__search-input') as HTMLInputElement;
				if (input) {
					input.focus();
				}
			}, 100);
		}
	}

	function closeSearch() {
		if (overlay) {
			overlay.classList.add('hidden');
			// Clear search input
			const input = overlay.querySelector('.pagefind-ui__search-input') as HTMLInputElement;
			if (input) {
				input.value = '';
				// Trigger input event to clear results
				input.dispatchEvent(new Event('input', { bubbles: true }));
			}
		}
	}
</script>